## 第１階層：環境構築ディレクトリ
- module listやmakefile, シェルscriptを読んだLLMが自動で📂を作成
- 「どうやって、環境構築・ビルド・実行するのか」という主要な構成を定義

## 第２階層：戦略ディレクトリ
- CUDA-MPI-OMP-{SIMD}-コンパイラ最適化レベル などのモジュールレベル
- ※アルゴリズムレベルの高速化実装 nonBlock, 転置, ループアンローリング は各PGに任せる

初期ディレクトリ構成例

環境構築📁直下に置く

### 要件定義の例
ユーザへの質疑応答の結果、以下の指定があったケースで考える
- 不老TypeIIを使用
- AutoTuningPlannerを除くエージェント数：12
- single-nodeの並列化が7割程度完成したらmulti-nodeへ
- singularityは使用しない


🤖はActiveなエージェントが存在することを意味する

下記のようにAgentリソースを適切に割り振り、効率的な最適化を行います

ディレクトリが進化していく様子を後でアニメーション化したいので
assign_history.txt📄には時刻も記載しておくこと

### 記法
- 🤖🥇(PM) プロジェクトで1体
- 🤖🥈(SE1) 1体~複数体： ハードウェア単位で置く
- 🤖🥉(CI1.1) SEの下に最低1体： module load等、主要な環境構築方法が異なる場合、割り当て
- 🤖(PG1.1.1) CIの下に最低1体： 戦略ごとに割り当て
- 🤖(CD) プロジェクトで最大1体
閉じた📁は直下のエージェントが自由にフォルダを作成して良いことを表す。
それ以外は、開いた📂で書く


### 初期化直後
```
OpenCodeAT📂
├── CLAUDE.md📄 (共通の指示)
├── assign_history.txt📄 (エージェントのアサイン記録)
├── 🤖🥇(PM)
├── GitHub📁🤖(CD)
└── Flow/TypeII📂
    └── single-node📂
        ├── 🤖🥈(SE1)
        ├── intel2024📂
        │   ├── 🤖🥉(CI1.1)
        │   ├── AVX512📁🤖(PG1.1.1)
        │   ├── MPI📁🤖(PG1.1.2)
        │   └── OpenMP📁🤖(PG1.1.3)
        ├── gcc11.3.0📂
        │   ├── 🤖🥉(CI1.2)
        │   ├── AVX2📁🤖(PG1.2.1)
        │   ├── OpenMP📁🤖(PG1.2.2)
        │   ├── MPI📁🤖(PG1.2.3)
        │   └── CUDA📁🤖(PG1.2.4)
        └── hpc_sdk23.1📂
            ├── 🤖🥉(CI1.3)
            └── OpenACC📁🤖(PG1.3.1)
    └── multi-node📂
```


### 一定時間経過後
```
OpenCodeAT📂
├── CLAUDE.md📄 (共通の指示)
├── assign_history.txt📄 (エージェントのアサイン記録)
├── 🤖🥇(PM)
├── GitHub📁🤖(CD)
└── Flow/TypeII📂
    └── single-node📂
        ├── 🤖🥈(SE1)
        ├── intel2024📂
        │   ├── 🤖🥉(CI1.1)
        │   ├── AVX512📁🤖(PG1.1.1)
        │   ├── MPI📁🤖(PG1.1.2)
        │   ├── OpenMP📁
        │   └── OpenMP-MPI📁🤖(PG1.1.3)
        ├── gcc11.3.0📂
        │   ├── 🤖🥉(CI1.2)
        │   ├── AVX2📁
        │   ├── OpenMP📁
        │   ├── OpenMP-MPI📁🤖(PG1.2.2)
        │   ├── OpenMP-MPI-AVX2📁🤖(PG1.2.1)
        │   ├── MPI📁
        │   └── CUDA📁🤖(PG1.2.4)
        └── hpc_sdk23.1📂
            ├── 🤖🥉(CI1.3)
            └── OpenACC📁🤖(PG1.3.1)
    └── multi-node📂

 Not Assigned PG1.2.3 🤖
```


### さらに一定時間経過後
```
OpenCodeAT📂
├── CLAUDE.md📄 (共通の指示)
├── assign_history.txt📄 (エージェントのアサイン記録)
├── 🤖🥇(PM)
├── GitHub📁🤖(CD)
└── Flow/TypeII📂
    ├── single-node📂
    │   ├── 🤖🥈(SE1)
    │   ├── intel2024📂
    │   │   ├── 🤖🥉(CI1.1)
    │   │   ├── AVX512📁
    │   │   ├── MPI📁🤖(PG1.1.2)
    │   │   ├── OpenMP📁
    │   │   ├── OpenMP-MPI📁🤖(PG1.1.3)
    │   │   └── OpenMP-MPI-AVX512📁🤖(PG1.1.1)
    │   ├── gcc11.3.0📂
    │   │   ├── 🤖🥉(CI1.2)
    │   │   ├── AVX2📁
    │   │   ├── OpenMP📁
    │   │   ├── OpenMP-MPI📁🤖(PG1.2.2)
    │   │   ├── OpenMP-MPI-AVX2📁🤖(PG1.2.1)
    │   │   ├── MPI📁 
    │   │   └── OpenMP-CUDA📁🤖(PG1.2.4)
    │   └── hpc_sdk23.1📂
    │       └── OpenACC📁
    └── multi-node📂
        ├── 🤖🥈(SE2)
        └── gcc11.3.0📂
            ├── 🤖🥉(CI2.1)  <-- 元CI1.3が再配置
            ├── MPI📁🤖(PG2.1.1)     <-- 元PG1.2.3が再配置
            └── OpenACC📁🤖(PG2.1.2) <-- 元PG1.3.1が再配置
```

### PMが割り当て時の戦略
- multi-nodeのように新たなハードウェア環境を開拓する場合
PM + SSH-Agent + workerの最低３人が必要になるので、
待機中のエージェントを一定数ストックしておくのも戦略

- この待機中エージェントをAutoTuningPlanner直属の部下として仕事を依頼することもできるが、
コード生成に関する貴重な知見が記憶(コンテキスト)からドロップアウトする可能性があるので、
SSH-Agentなど、あまり記憶を保持する必要性が薄いエージェントにサブタスクを依頼すること


### メッセージ送信時の注意点
しかしagent_send.shは、送り先のエージェントが待機中でない場合
作業を中断させる強制割り込みに相当し、競合し得るので
以下のワークフローに従うこと



### PG🤖視点
```
PG🤖はコード生成後changes.mdに追記 → 待機

CI🤖🥉がSSH先で実行 → changes.mdの該当箇所に結果などを追記
CIがagent_send.shでPG🤖に終了したという合図を送る

PG🤖はchanges.mdの追記を見て
もし、SEから与えられた目標を達成した場合：
　　SE🤖🥈に agent_send.shで成果報告を行う
そうでなければ：
　　修正案を練る
```



### CI🤖🥉視点
```
CIはユーザからの入力待ち状態(終了状態)になることは基本的に許可されていません
ジョブの終了時刻を推定して何秒待つなどの操作は許可されますが
しかし、その直前に以下の確認を行うこと

複数のPGのChanges.mdに追記がないか常に監視し
新たに生成したコードはSSH先に転送し実行

ジョブ一覧のうち、あなたが担当しているIDを管理するために
job_list_CI1.1.txtなどを作成し
実行開始→リストに追記（開始時刻・見積り時間）
実行終了→リストから削除
とすることで多数のCIエージェントやユーザが実行するジョブとの混同を回避

終了時 changes.mdの該当箇所に結果などを追記 CIがagent_send.shでPG🤖に終了したという合図を送る
```



### SE🤖🥈視点
```
SEはユーザからの入力待ち状態(終了状態)になることは基本的に許可されていません

PG,CIの監視
各エージェントが自分の責務を果たしているかを確認

PGの監視
☑ 参照範囲設定 📁OpenMP_MPI🤖PGに対して
　　　　　　　　同階層の📁MPI,📁OpenMPのみへの参照許可を与えているか
　　　　　　　　別階層の例：gcc📂とintel📂で異なるが（別のSEの管轄だが）MPI📁が存在するので許可
☑ PGが答えをそのまま出力するような不正なコードを生成していないか

CIの監視
☑ 有用テストコード
☑ 適切にmodule loadやmakeを行っているか
```


### PM🤖🥇視点
```
PMはユーザとの対話を優先して行い、要件定義を行う
ディレクトリ全体の階層構成とエージェントの配置を担当
最適化などの要件に基づき、現状の課題や最優先事項を考え
計画的にリソースの割り当てを行う
```


### CD🤖視点
```
agent_send.shを用いた通信は基本的には行わない
ユーザやPMの方針に従い、GitHubの管理を行う
```